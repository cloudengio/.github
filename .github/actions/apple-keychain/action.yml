name: apple signing support
description: create a file base keychain
inputs:
  keychain-name:
    description: "Name of the keychain to create"
    required: false
    default: "keychain-ci-testing.keychain-db"
  keychain-password:
    description: "Password for the keychain, a random one will be generated if not provided"
    required: false
    default: ""
  certificate-p12-base64:
    description: "Base64 encoded P12 certificate"
    required: false
runs:
  using: "composite"
  steps:
    - shell: bash
      if: ${{ runner.os == 'macOS' }}
      run: |
        PASSWORD=${{ inputs.keychain-password }}
        if [ -z "$PASSWORD" ]; then
          PASSWORD=$(openssl rand -base64 12)
        fi
        KEYCHAIN_PATH=$RUNNER_TEMP/${{ inputs.keychain-name }}
        security create-keychain -p $PASSWORD $KEYCHAIN_PATH
        security unlock-keychain -p $PASSWORD $KEYCHAIN_PATH
        security list-keychains -d user -s $KEYCHAIN_PATH # Add the new keychain to the search path
        security import $RUNNER_TEMP/certificate.p12 -P $PASSWORD -A -t cert -f pkcs12 -k $KEYCHAIN_PATH
